// Generated by CoffeeScript 1.9.2
(function() {
  var generateRandomStr, getCondidates, lower, lowerSmart, number, numberSmart, upper, upperSmart,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  lower = "abcdefghijklmnopqrstuvwxyz";

  lowerSmart = "abcdefghjkmnpqrstuvwxyz";

  upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

  upperSmart = "ABCDEFGHJKMNPRSTUVWXY";

  number = "0123456789";

  numberSmart = "3456789";


  /*
      generate id
      @param {Object} [options]
      @param {String} [options.mode = "aA0"] mode: 0 = 0 ~ 9, a = a ~ z, A = A ~ Z, s = smart, other characters = add these characters in candidate
      @param {Number} [options.length = 10]
      @return {String} random string
   */

  exports.make = function(mode, length) {
    var condidates;
    if (!mode) {
      mode = "aA0";
    }
    if (!length) {
      length = 10;
    }
    if (length < 1) {
      throw new Error("length should be a positive number");
    }
    condidates = getCondidates(mode);
    return generateRandomStr(condidates, length);
  };


  /*
      get condidates characters
      @param {String} mode
      @return {String} condidate characters
   */

  getCondidates = function(mode) {
    var c, characters, isSmart, j, len;
    isSmart = indexOf.call(mode, "s") >= 0;
    characters = "";
    for (j = 0, len = mode.length; j < len; j++) {
      c = mode[j];
      switch (c) {
        case "a":
          characters += (isSmart ? lowerSmart : lower);
          break;
        case "A":
          characters += (isSmart ? upperSmart : upper);
          break;
        case "0":
          characters += (isSmart ? numberSmart : number);
          break;
        default:
          characters += c;
      }
    }
    return characters;
  };


  /*
      generate a random string
      @param {String} condidateChars
      @param {Number} length
      @return {String} random string
   */

  generateRandomStr = function(condidateChars, length) {
    var i, j, randomStr, ref;
    randomStr = "";
    for (i = j = 1, ref = length; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {
      randomStr += condidateChars[~~(Math.random() * condidateChars.length)];
    }
    return randomStr;
  };

}).call(this);
